(function(e){var t=Drupal.styleHtml;var n={init:function(){e(".el-block").live({mouseenter:function(){e(this).addClass("el-hover")},mouseleave:function(){e(this).removeClass("el-hover")}});e('#mni-layout input[name="column_grid"]').change(function(){var t=e("#mni-layout input:radio:checked").val()||12;var r=[];r["isFull"]=true;r["subWidth"]="";n.applyNumCol(t,n.getConfigObject("[[24,24],[48]]"),r)}).change();e("#itemcolumn div.item").click(function(){e("#el-gen").html("");n.getLayoutHtml(n.getConfigObject(e(this).attr("value")))});e("#el-gen").sortable({handle:"a.handle",revert:false,placeholder:"ui-state-highlight",items:"div.el-row"});e("#layout_newrow").click(function(){var t=e("#mni-layout input:radio:checked").val();n.getLayoutHtml(n.getConfigObject("[[48]]"));return false});e("#layout_save").click(function(){var t=[];e("#el-gen .el-row").each(function(){var r=[];e(this).find(".el-block").each(function(){r.push(n.extractColNum(e(this)))});t.push(r)});alert(e.objectToString(t))});e(".el-delete").live("click",function(){var t=e(this).parent();var r=n.extractColNum(t);if(r>0&&r<12){var i=t.next("div.el-block");var s=n.extractColNum(i);if(!n.updateColNum(i,s+r)){var o=t.prev("div.el-block");var u=n.extractColNum(o);n.updateColNum(o,u+r)}t.remove()}else{e(this).parent().parent().remove()}return false});t.appendTo(document.body).hide();e("input.color-picker",t).ColorPicker({onSubmit:function(t,n,r,i){e(i).val(n);e(i).ColorPickerHide()},onBeforeShow:function(){current_obj=this;e(this).ColorPickerSetColor(this.value)},onChange:function(t,n,r){e(current_obj).val(n)}}).bind("keyup",function(){e(this).ColorPickerSetColor(this.value)});e("a.btn_save",t).click(function(){var r=n.getStyleHtmlVal();parent=t.data("item");parent.children("input.setting").val(e.objectToString(r));t.hide();return false});e("a.btn_cancel",t).click(function(){t.hide();return false});e(".el-style, .el-globalstyle").live("click",function(){var r=e(this).offset();var i=e(this).parent();var s=i.children("input.setting").val();n.setStyleHtmlVal(e.stringToObject(s));t.data("item",i).css({top:r.top+19,left:r.left-13}).show();return false});e(".el-split").live("click",function(){var t=e(this).parent();var r=t.parent();var i=n.extractColNum(t);if(i>1){var s=Math.floor(i/2);var o=i-s;n.updateColNum(t,o);t.after(n.getColTemplate(s))}return false});e(".el-wider").live("click",function(){var t=e(this).parent();var r=t.next("div.el-block");if(n.shortenCol(r,"next")){var i=n.extractColNum(t);n.updateColNum(t,++i)}return false});e(".el-shorten").live("click",function(){var t=e(this).parent();var r=t.prev("div.el-block");if(n.shortenCol(r,"prev")){var i=n.extractColNum(t);n.updateColNum(t,++i)}return false})},getLayoutConfig:function(){var t=[];var r=n.extractColNum(e("#el-gen"));var i=n.extractFullWidth();e("#el-gen .el-row").each(function(){var i=[];e(this).find(".el-block").each(function(){i.push({style:e.stringToObject(e(this).children("input.setting").val()),length:n.extractColNum(e(this))*48/r})});t.push({style:e.stringToObject(e(this).children("input.setting").val()),cols:i})});return{numCol:r,setting:t,isFullWidth:i["isFull"],subWidth:i["subWidth"]}},applyLayoutConfig:function(e){var t=[];t["isFull"]=e.isFullWidth;t["subWidth"]=e.subWidth;n.applyNumCol(e.numCol,e.setting,t)},shortenCol:function(e,t){if(e!=null&&e.length>0){var r=n.extractColNum(e);if(r>1){n.updateColNum(e,--r);return true}else{if(t=="next"){return n.shortenCol(e.next("div.el-block"),t)}else{return n.shortenCol(e.prev("div.el-block"),t)}}}return false},updateColNum:function(e,t){if(t>0&&t<13&&e!=null&&e.length>0){e.removeClass("mmg_1 mmg_2 mmg_3 mmg_4 mmg_5 mmg_6 mmg_7 mmg_8 mmg_9 mmg_10 mmg_11 mmg_12 mmg_13 mmg_14 mmg_15 mmg_16");e.addClass("mmg_"+t);return true}return false},extractSpanNum:function(t){var n,r,i;n=e(t).attr("class"),r=n.split(/\s+/);for(i=0;i<r.length;i+=1)if(r[i].match(/^mmg_/))return r[i].split("_")[1]},extractColNum:function(e){var t;if(e!=null&&e.length>0){t=e.attr("class").match(/\d+/)}t=t?parseInt(t[0]):0;return t},extractFullWidth:function(){var t=[];t["isFull"]=e("#submnu_full_width").is(":checked");t["subWidth"]="";if(!t["isFull"]&&!isNaN(parseInt(e("#mnu_subwid").val()))){t["subWidth"]=e("#mnu_subwid").val()}return t},getColTemplate:function(t,n){var r=e('<div class="el-block mmg_'+t+'">'+'<a href="#" class="el-delete" title="Delete this column"></a>'+'<a href="#" class="el-style" title="Change column style"></a><input type="hidden" class="setting" value="" autocomplete="off" />'+'<a href="#" class="el-split" title="Split column"></a>'+'<a href="#" class="el-wider" title="Make this column wider"></a>'+'<a href="#" class="el-shorten" title="Make this column shorten"></a>'+"</div>");r.children("input.setting").val(e.objectToString(n));return r.clone()},getLayoutHtml:function(t){var r=n.extractColNum(e("#el-gen"));t=typeof t=="string"?e.stringToObject(t):t;if(t.length>0){for(var i=0;i<t.length;i++){var s=t[i];row=e('<div class="el-row"><a href="#" class="handle"></a><a href="#" class="el-globalstyle" title="Change row style"></a><input type="hidden" class="setting" value="" autocomplete="off" /></div>');row.children("input.setting").val(e.objectToString(s.style));cols=s.cols;if(cols!=undefined){var o=0;for(var u=0;u<cols.length-1;u++){var a=parseInt(cols[u].length*r/48);o+=a;if(o<r){row.append(n.getColTemplate(a,cols[u].style))}}if(o<r){row.append(n.getColTemplate(r-o,cols[cols.length-1].style))}}e("#el-gen").append(row)}}},applyNumCol:function(t,r,i){e('input:radio[name="column_grid"][value="'+t+'"]').attr("checked",true);e("#submnu_full_width").attr("checked",i["isFull"]);e("#mnu_subwid").val(i["subWidth"]);e("#el-gen").removeClass("fluid_mmcontainer_12 fluid_mmcontainer_16").addClass("fluid_mmcontainer_"+t);e("#el-gen").html("");n.getLayoutHtml(r)},setStyleHtmlVal:function(n){n=e.extend({elsmargin:false,elsbackground:"",elsborderw:"",elsborders:"",elsborderc:""},n);e('input[name="els-margin"]',t).attr("checked",n.elsmargin),e('input[name="els-background"]').val(n.elsbackground);e('input[name="els-borderw"]').val(n.elsborderw);e('select[name="els-borders"]').val(n.elsborders);e('input[name="els-borderc"]').val(n.elsborderc)},getConfigObject:function(t){var n=[];var r=e.stringToObject(t);for(var i=0;i<r.length;i++){rowSetting={style:null,cols:[]};for(var s=0;s<r[i].length;s++){rowSetting.cols.push({style:null,length:r[i][s]})}n.push(rowSetting)}return n},getStyleHtmlVal:function(){return{elsmargin:e('input[name="els-margin"]',t).is(":checked")?true:false,elsbackground:e('input[name="els-background"]').val(),elsborderw:e('input[name="els-borderw"]').val(),elsborders:e('select[name="els-borders"]').val(),elsborderc:e('input[name="els-borderc"]').val()}}};Drupal.menuLayout=n})(jQuery)