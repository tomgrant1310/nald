(function(c){var b=Drupal.styleHtml;var a={init:function(){c(".el-block").live({mouseenter:function(){c(this).addClass("el-hover")},mouseleave:function(){c(this).removeClass("el-hover")}});c('#mni-layout input[name="column_grid"]').change(function(){var d=c("#mni-layout input:radio:checked").val()||12;var e=[];e.isFull=true;e.subWidth="";a.applyNumCol(d,a.getConfigObject("[[24,24],[48]]"),e)}).change();c("#itemcolumn div.item").click(function(){c("#el-gen").html("");a.getLayoutHtml(a.getConfigObject(c(this).attr("value")))});c("#el-gen").sortable({handle:"a.handle",revert:false,placeholder:"ui-state-highlight",items:"div.el-row"});c("#layout_newrow").click(function(){var d=c("#mni-layout input:radio:checked").val();a.getLayoutHtml(a.getConfigObject("[[48]]"));return false});c("#layout_save").click(function(){var d=[];c("#el-gen .el-row").each(function(){var e=[];c(this).find(".el-block").each(function(){e.push(a.extractColNum(c(this)))});d.push(e)});alert(c.objectToString(d))});c(".el-delete").live("click",function(){var g=c(this).parent();var e=a.extractColNum(g);if(e>0&&e<12){var f=g.next("div.el-block");var i=a.extractColNum(f);if(!a.updateColNum(f,(i+e))){var h=g.prev("div.el-block");var d=a.extractColNum(h);a.updateColNum(h,(d+e))}g.remove()}else{c(this).parent().parent().remove()}return false});b.appendTo(document.body).hide();c("input.color-picker",b).ColorPicker({onSubmit:function(d,g,e,f){c(f).val(g);c(f).ColorPickerHide()},onBeforeShow:function(){current_obj=this;c(this).ColorPickerSetColor(this.value)},onChange:function(d,f,e){c(current_obj).val(f)}}).bind("keyup",function(){c(this).ColorPickerSetColor(this.value)});c("a.btn_save",b).click(function(){var d=a.getStyleHtmlVal();parent=b.data("item");parent.children("input.setting").val(c.objectToString(d));b.hide();return false});c("a.btn_cancel",b).click(function(){b.hide();return false});c(".el-style, .el-globalstyle").live("click",function(){var f=c(this).offset();var e=c(this).parent();var d=e.children("input.setting").val();a.setStyleHtmlVal(c.stringToObject(d));b.data("item",e).css({top:f.top+19,left:f.left-13}).show();return false});c(".el-split").live("click",function(){var e=c(this).parent();var h=e.parent();var d=a.extractColNum(e);if(d>1){var g=Math.floor(d/2);var f=d-g;a.updateColNum(e,f);e.after(a.getColTemplate(g))}return false});c(".el-wider").live("click",function(){var f=c(this).parent();var e=f.next("div.el-block");if(a.shortenCol(e,"next")){var d=a.extractColNum(f);a.updateColNum(f,++d)}return false});c(".el-shorten").live("click",function(){var f=c(this).parent();var e=f.prev("div.el-block");if(a.shortenCol(e,"prev")){var d=a.extractColNum(f);a.updateColNum(f,++d)}return false})},getLayoutConfig:function(){var e=[];var d=a.extractColNum(c("#el-gen"));var f=a.extractFullWidth();c("#el-gen .el-row").each(function(){var g=[];c(this).find(".el-block").each(function(){g.push({style:c.stringToObject(c(this).children("input.setting").val()),length:(a.extractColNum(c(this))*48/d)})});e.push({style:c.stringToObject(c(this).children("input.setting").val()),cols:g})});return{numCol:d,setting:e,isFullWidth:f.isFull,subWidth:f.subWidth}},applyLayoutConfig:function(d){var e=[];e.isFull=d.isFullWidth;e.subWidth=d.subWidth;a.applyNumCol(d.numCol,d.setting,e)},shortenCol:function(e,f){if(e!=null&&e.length>0){var d=a.extractColNum(e);if(d>1){a.updateColNum(e,--d);return true}else{if(f=="next"){return a.shortenCol(e.next("div.el-block"),f)}else{return a.shortenCol(e.prev("div.el-block"),f)}}}return false},updateColNum:function(e,d){if(d>0&&d<13&&e!=null&&e.length>0){e.removeClass("mmg_1 mmg_2 mmg_3 mmg_4 mmg_5 mmg_6 mmg_7 mmg_8 mmg_9 mmg_10 mmg_11 mmg_12 mmg_13 mmg_14 mmg_15 mmg_16");e.addClass("mmg_"+d);return true}return false},extractSpanNum:function(f){var e,h,g;e=c(f).attr("class"),h=e.split(/\s+/);for(g=0;g<h.length;g+=1){if(h[g].match(/^mmg_/)){return h[g].split("_")[1]}}},extractColNum:function(e){var d;if(e!=null&&e.length>0){d=e.attr("class").match(/\d+/)}d=d?parseInt(d[0]):0;return d},extractFullWidth:function(){var d=[];d.isFull=c("#submnu_full_width").is(":checked");d.subWidth="";if(!d.isFull&&!isNaN(parseInt(c("#mnu_subwid").val()))){d.subWidth=c("#mnu_subwid").val()}return d},getColTemplate:function(f,e){var d=c('<div class="el-block mmg_'+f+'"><a href="#" class="el-delete" title="Delete this column"></a><a href="#" class="el-style" title="Change column style"></a><input type="hidden" class="setting" value="" autocomplete="off" /><a href="#" class="el-split" title="Split column"></a><a href="#" class="el-wider" title="Make this column wider"></a><a href="#" class="el-shorten" title="Make this column shorten"></a></div>');d.children("input.setting").val(c.objectToString(e));return d.clone()},getLayoutHtml:function(k){var e=a.extractColNum(c("#el-gen"));k=(typeof k=="string")?c.stringToObject(k):k;if(k.length>0){for(var h=0;h<k.length;h++){var l=k[h];row=c('<div class="el-row"><a href="#" class="handle"></a><a href="#" class="el-globalstyle" title="Change row style"></a><input type="hidden" class="setting" value="" autocomplete="off" /></div>');row.children("input.setting").val(c.objectToString(l.style));cols=l.cols;if(cols!=undefined){var g=0;for(var f=0;f<(cols.length-1);f++){var d=parseInt(cols[f].length*e/48);g+=d;if(g<e){row.append(a.getColTemplate(d,cols[f].style))}}if(g<e){row.append(a.getColTemplate(e-g,cols[cols.length-1].style))}}c("#el-gen").append(row)}}},applyNumCol:function(e,d,f){c('input:radio[name="column_grid"][value="'+e+'"]').attr("checked",true);c("#submnu_full_width").attr("checked",f.isFull);c("#mnu_subwid").val(f.subWidth);c("#el-gen").removeClass("fluid_mmcontainer_12 fluid_mmcontainer_16").addClass("fluid_mmcontainer_"+e);c("#el-gen").html("");a.getLayoutHtml(d)},setStyleHtmlVal:function(d){d=c.extend({elsmargin:false,elsbackground:"",elsborderw:"",elsborders:"",elsborderc:""},d);c('input[name="els-margin"]',b).attr("checked",d.elsmargin),c('input[name="els-background"]').val(d.elsbackground);c('input[name="els-borderw"]').val(d.elsborderw);c('select[name="els-borders"]').val(d.elsborders);c('input[name="els-borderc"]').val(d.elsborderc)},getConfigObject:function(h){var g=[];var e=c.stringToObject(h);for(var f=0;f<e.length;f++){rowSetting={style:null,cols:[]};for(var d=0;d<e[f].length;d++){rowSetting.cols.push({style:null,length:e[f][d]})}g.push(rowSetting)}return g},getStyleHtmlVal:function(){return{elsmargin:c('input[name="els-margin"]',b).is(":checked")?true:false,elsbackground:c('input[name="els-background"]').val(),elsborderw:c('input[name="els-borderw"]').val(),elsborders:c('select[name="els-borders"]').val(),elsborderc:c('input[name="els-borderc"]').val()}}};Drupal.menuLayout=a})(jQuery);