(function(e){var t=Drupal.menuLayout;var n=Drupal.styleHtml;var r=Drupal.menuItem;var i={tabs:null,tab_counter:e("ul li.tab-item").length+1,dlg_itemsettings:null,init:function(){e(".md-tabs-head li").live({mouseenter:function(){e(this).find(".ui-icon-close").show()},mouseleave:function(){e(this).find(".ui-icon-close").hide()}});e(".md-tabs-head span.ui-icon-close").live("click",function(){var t=this;var n=e(this).prev("a").attr("href");var r=e("input.settings",e(n)).val();r=e.stringToObject(r);if(!confirm("Are you sure to delete this tab?")){return}var s=e(n).find(".block-item");for(var o=0;o<s.length;o++){var u=s[o];var a=e.unserialize(e(u).find("input[type=hidden]").val()).block_module;e("#"+a).append(u)}if(r.tab_id==0){var f=e("li",i.tabs).index(e(this).parent());i.tabs.tabs("remove",f)}else{e.ajax({url:Drupal.settings.basePath+"?q=admin/structure/md-megamenu/delete-tab",type:"POST",data:{tab:r.tab_id,token_value:e("input#delete_tab_token").val()},dataType:"json",success:function(n){if(n.message=="OK"){var r=e("li",i.tabs).index(e(t).parent());i.tabs.tabs("remove",r)}}})}});i.dlg_itemsettings=e("#dlg-mnuitemsetting").dialog({resizable:false,autoOpen:false,draggable:false,modal:true,width:1e3,open:function(){var t=e(this).data("settings");var n=e.stringToObject(t);if(n!=null){i.setMenuFormVal(n)}else{var r=e("form",i.dlg_itemsettings)[0];r.reset();e(r).find("input[type=hidden]").each(function(){this.value=""});e(r).find(".image-preview").empty()}e(".md-subtabs").tabs("select",0);e("#mnu_title",i.dlg_itemsettings).focus();e("#title_enabled").trigger("change")},close:function(){e("form",i.dlg_itemsettings)[0].reset();n.hide()}});e("#add_tab").click(function(){i.dlg_itemsettings.data("settings",null).data("id",null).dialog({title:"Add new menu item",buttons:{Add:function(){i.addTab();e(this).dialog("close")},Cancel:function(){e(this).dialog("close")}}}).dialog("open");return false});e(".mnu-settings").live("click",function(){console.log("aaaaa");var t=e(this).parent().find("input.settings").val();var n=e(this).parent().parent().attr("id");i.dlg_itemsettings.data("settings",t).data("id",n).dialog({title:"Menu item data",buttons:{Save:function(){if(e("#form-mnuitemsetting").valid()){var t=e(this).data("id");var n=i.getMenuFormVal();i.updateTabSetting(t,n);e(this).dialog("close")}},Cancel:function(){e(this).dialog("close")}}}).dialog("open");e("#submnu_full_width").trigger("change");return false});e("#form-mnuitemsetting").validate();e("#blocklist").tabs();e("#mni-subtabs").tabs({select:function(e,t){n.hide()}});e(".md-listleft a").click(function(){e(this).parent().parent().find("a").removeClass("border-white");e(this).parent().prev().find("a").addClass("border-white")});e(".md-listleft li.ui-state-active").each(function(){e(this).prev().find("a").addClass("border-white")});e("#md-subtabs .itemcol").click(function(){e("#md-subtabs .itemcol").removeClass("selected");e(this).addClass("selected")});e(".el-block").live({mouseenter:function(){e(this).addClass("el-hover")},mouseleave:function(){e(this).removeClass("el-hover")}});dlg_mmsettings=e("#dlg-mmsetting").dialog({resizable:false,autoOpen:false,draggable:false,modal:true,width:680,buttons:{OK:function(){e(this).dialog("close")}},open:function(){jQuery(".ui-widget-overlay").bind("click",function(){dlg_mmsettings.dialog("close")})}});e("#megamenu-setting").live("click",function(){dlg_mmsettings.dialog("open");return false});e("#title_enabled").change(function(){if(e(this).is(":checked")){e("#mnu_title").attr("disabled",false)}else{e("#mnu_title").attr("disabled",true)}});i.flyoutItem=e("#dlg-flyout-item").dialog({resizable:false,autoOpen:false,draggable:false,modal:true,width:600,buttons:{OK:function(){$item=e(this).data("item");var t=i.getFormVal(e("#dlg-flyout-item form"));title=t["a_title"]!==undefined?t["a_title"]:"";e(">dl >dt >a.sm2_title",$item).html(title);$item.children("input.setting").val(e.objectToString(t));if(!$item.hasClass("ei-processed")){$item.addClass("ei-processed")}e(this).dialog("close")},Cancel:function(){e(this).dialog("close")}},close:function(){$item=e(this).data("item");if($item!=null&&!$item.hasClass("ei-processed")){$item.remove()}}});e("#md-tabs").find("div.tree > ul").megadrupalTreeMenu();e("a.mnu-addnewlink").live("click",function(){newli=e(Drupal.flyMenuItem);$tree=e(this).parent().prev("div.tree");e("> ul",$tree).append(newli).megadrupalTreeMenu();newli.find("a.fly-item-edit").trigger("click")});e("a.fly-item-edit").live("click",function(){item=e(this).parent().parent().parent();var t=e.stringToObject(item.find("input.setting").val());e("#dlg-flyout-item").loadingDialog();e("#dlg-flyout-item").dialog("open");e.post(Drupal.settings.basePath+"?q=admin/structure/md-megamenu/essential-item",t,function(t){e("#dlg-flyout-item").html(t);i.flyoutItem.data("item",item).unLoadingDialog()});return false});e("a.fly-item-delete").live("click",function(){e(this).parent().parent().parent().remove()});i.tabs=e("#md-tabs")},initTab:function(){i.tabs.tabs({cookie:{expires:1},tabTemplate:'<li class="tab-item clearfix"><a class="tab-link" href="#{href}"><span class="tab-text">#{label}</span></a> <span class="ui-icon ui-icon-close">Remove Tab</span></li>',add:function(t,n){e(n.panel).append('<div class="settings"><a href="#" class="mnu-settings">[settings]</a><input autocomplete="off" type="hidden" class="settings" />'+'</div><div class="md-menudropdown clearfix"><div class="tree"></div><div class="dropdown-addnew"><a href="#" class="mnu-addnewlink">[add new link]</a></div></div><div class="md-menuwrap md-1col1 clearfix"></div>');i.tabs.tabs("select",n.index)},remove:function(t,n){e(n.panel).find("div.md-bl").each(function(){var t=e.unserialize(e(this).find("input.setting").val());if(t.type.substr(0,5)=="block"){e("#blocks").append(e(this))}})}});this.sortTab()},removeIcon:function(t){e("#icon_url").val("").change()},sortTab:function(){i.tabs.find(".ui-tabs-nav").sortable({axis:"x",stop:function(){i.tabs.tabs("refresh")}})},addTab:function(){var t=e("#mnu_title").val()||"Tab "+i.tab_counter;var n="tabs-"+i.tab_counter;i.tabs.tabs("add","#tabs-"+i.tab_counter,t);i.updateTabSetting(n,i.getMenuFormVal());i.tab_counter++},getSelectedTabIndex:function(){return i.tabs.tabs("option","selected")},updateTabSetting:function(t,n){if(n.mnu_fly_type){e("#"+t).find("div.md-menuwrap").hide();if(n.title_enabled)e('a[href$="#'+t+'"] .tab-text').html(n.mnu_title);else e('a[href$="#'+t+'"] .tab-text').html("");$menuflyout=e("#"+t).find("div.md-menudropdown");$tree=$menuflyout.show().find(".tree");if($tree.is(":empty")){$tree.html("<ul></ul>");e("> ul",$tree).megadrupalTreeMenu()}e("#"+t).find("input.settings").val(e.objectToString(n))}else{e("#"+t).find("div.md-menudropdown").hide();e("#"+t).find("div.md-menuwrap").show();if(n.title_enabled)e('a[href$="#'+t+'"] .tab-text').html(n.mnu_title);else e('a[href$="#'+t+'"] .tab-text').html("");var s=e('a[href$="#'+t+'"] img');if(e("#dmg-menuicon").is(":checked")&&n.icon_url&&n.icon_url!=""){if(s.length>0){s.attr("src",n.icon_url)}else{e('a[href$="#'+t+'"]').prepend('<img width="16" height="16" src="'+n.icon_url+'">')}}else{if(s.length){s.remove()}}e("#"+t).find("input.settings").val(e.objectToString(n));var o=e("#"+t).find(".md-menuwrap");var u=n.mnu_layout;var a=o.find(".md-col");if(a.length==0){i.changeLayout(o,u)}else{oldColContent=[];e.each(a,function(t,n){oldColContent.push(e(n).find(".inner").html())});i.changeLayout(o,u);var f=o.find(".md-col");e.each(oldColContent,function(t,n){if(t<f.length){e(f[t]).find(".inner").html(n)}else{e(f[f.length-1]).find(".inner").append(n)}})}r.mdcolsort()}},changeLayout:function(e,t){e.removeClass("fluid_mmcontainer_12 fluid_mmcontainer_16").addClass("fluid_mmcontainer_"+t.numCol);e.html(i.getMenuTabHtml(t.setting,t.numCol))},getMenuTabHtml:function(t,n){var r="";t=typeof t=="string"?e.stringToObject(t):t;if(t.length>0){for(var i=0;i<t.length;i++){var s=t[i];r+='<div class="md-row clearfix">';for(var o=0;o<s.cols.length;o++){var u=parseInt(s.cols[o].length*n/48);r+='<div class="md-col {grid}"><div class="inner ui-sortable"></div></div>'.replace("{grid}","mmg_"+u);}r+="</div>"}}return r},getMenuFormVal:function(){var n=t.getLayoutConfig();return{mnu_fly_type:e('#dlg-mnuitemsetting input[name="mnu_type"]').is(":checked")?false:true,title_enabled:e('#dlg-mnuitemsetting input[name="title_enabled"]').is(":checked")?true:false,mnu_title:e('#dlg-mnuitemsetting input[name="mnu_title"]').val(),mnu_path:e('#dlg-mnuitemsetting input[name="mnu_path"]').val(),icon_url:e('#dlg-mnuitemsetting input[name="icon_url"]').val(),mnu_desc:e('#dlg-mnuitemsetting textarea[name="mnu_desc"]').val(),mnu_class:e('#dlg-mnuitemsetting input[name="mnu_class"]').val(),mnu_id:e("input[name=menu_id]").val(),tab_id:e("#mnu_tab_id").val(),mnu_layout:n}},setMenuFormVal:function(n){e("#dlg-mnuitemsetting input[name=mnu_type]").attr("checked",!n.mnu_fly_type);e("#dlg-mnuitemsetting input[name=mnu_title]").val(n.mnu_title);e('#dlg-mnuitemsetting input[name="mnu_path"]').val(n.mnu_path);e('#dlg-mnuitemsetting textarea[name="mnu_desc"] ').val(n.mnu_desc);e('#dlg-mnuitemsetting input[name="icon_url"]').val(n.icon_url);t.applyLayoutConfig(n.mnu_layout);e('#dlg-mnuitemsetting input[name="mnu_class"]').val(n.mnu_class);e('#dlg-mnuitemsetting input[name="dms-bgc"]').val(n.smn_bgc);e('#dlg-mnuitemsetting input[name="dms-bow"]').val(n.smn_bow);e('#dlg-mnuitemsetting select[name="dms-bos"]').val(n.smn_bos);e('#dlg-mnuitemsetting input[name="dms-boc"]').val(n.smn_boc);e("#mnu_tab_id").val(n.tab_id);if(n.icon_url!=null&&n.icon_url!=""){var r=n.icon_url.split("&")[1];r=r.split("=")[1];var i=e("<img/>").attr("src",r);e("#dlg-mnuitemsetting .image-preview").empty().append(i)}},getFormVal:function(t){var n={};e("input, select, textarea",e(t)).each(function(){n[e(this).attr("name")]=e(this).val()});return n}};Drupal.menuTab=i})(jQuery)